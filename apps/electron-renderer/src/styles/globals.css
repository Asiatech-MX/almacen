@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@source '../**/*.{tsx,ts,jsx,js}';
@source '../index.html';

/* Force HMR update */

/* Skeleton styles for TanStack Query loading states */
@layer components {
  .skeleton-select {
    @apply h-10 bg-muted rounded-md animate-pulse;
    @apply border border-input shadow-sm;
    @apply relative overflow-hidden;
  }

  .skeleton-select::before {
    @apply absolute inset-0 bg-gradient-to-r from-transparent via-muted-foreground/20 to-transparent;
    animation: shimmer 2s infinite;
    content: '';
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .loading-skeleton-shine {
    @apply absolute inset-0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    animation: skeleton-shine 1.5s infinite;
  }

  @keyframes skeleton-shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
}

@utility container {
  margin-inline: auto;
  padding-inline: 2rem;
  @media (width >= 640px) {
    max-width: none;
  }
  @media (width >= 1400px) {
    max-width: 1400px;
  }
}

@theme {
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));

  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));

  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));

  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));

  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));

  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));

  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));

  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));

  --color-sidebar: hsl(var(--sidebar));
  --color-sidebar-foreground: hsl(var(--sidebar-foreground));
  --color-sidebar-primary: hsl(var(--sidebar-primary));
  --color-sidebar-primary-foreground: hsl(var(--sidebar-primary-foreground));
  --color-sidebar-accent: hsl(var(--sidebar-accent));
  --color-sidebar-accent-foreground: hsl(var(--sidebar-accent-foreground));
  --color-sidebar-border: hsl(var(--sidebar-border));
  --color-sidebar-ring: hsl(var(--sidebar-ring));

  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);

  --animate-accordion-down: accordion-down 0.2s ease-out;
  --animate-accordion-up: accordion-up 0.2s ease-out;

  @keyframes accordion-down {
    from {
      height: 0;
    }
    to {
      height: var(--radix-accordion-content-height);
    }
  }
  @keyframes accordion-up {
    from {
      height: var(--radix-accordion-content-height);
    }
    to {
      height: 0;
    }
  }
}

/*
  The default border color has changed to `currentcolor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }
}

@utility sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;

  /* High contrast mode support */

  /* Reduced motion support */
}
@utility focus-visible {
  &:focus {
    outline: 2px solid var(--color-ring);
    outline-offset: 2px;
  }

  /* High contrast mode support */

  /* Reduced motion support */
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;
    --radius: 0.5rem;
    --sidebar: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;
    --sidebar: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  /* CSS Reset compatible con Tailwind y evitando conflictos */
  * {
    box-sizing: border-box;
    border-color: hsl(var(--border));
  }

  *::before,
  *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
      sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
    overflow-x: hidden;
  }

  #root {
    height: 100vh;
    width: 100vw;
  }

  button {
    font-family: inherit;
  }

  input, select, textarea {
    font-family: inherit;
  }

  code {
    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
      monospace;
  }
}

/* Accessibility enhancements */
@layer utilities {
  @media (prefers-contrast: high) {
    :root {
      --border: 0 0% 0%;
      --ring: 0 0% 0%;
    }
  }
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
}



/* React-select v4 + Tailwind CSS v4 Integration Styles */
@layer components {
  /* Base container */
  .react-select-container {
    position: relative;
  }

  /* Main control input */
  .react-select__control {
    @apply border border-input bg-background text-foreground rounded-md shadow-sm;
    @apply hover:border-primary/50 transition-colors duration-200;
    min-height: 2.5rem;

    &.react-select__control--is-focused {
      @apply border-primary ring-2 ring-primary/20;
    }

    &.react-select__control--menu-is-open {
      @apply border-primary;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }

    &.react-select__control--is-disabled {
      @apply bg-muted text-muted-foreground cursor-not-allowed;
    }
  }

  /* Value container */
  .react-select__value-container {
    @apply px-3 py-1;
  }

  /* Placeholder */
  .react-select__placeholder {
    @apply text-muted-foreground px-3;
  }

  /* Selected value */
  .react-select__single-value {
    @apply text-foreground px-3;
  }

  /* Input field */
  .react-select__input-container {
    @apply px-3;
  }

  /* Dropdown menu */
  .react-select__menu {
    @apply bg-background border border-input rounded-md rounded-tl-none rounded-tr-none shadow-lg;
    @apply mt-1 z-50;
    margin-top: -1px;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
  }

  /* Menu list */
  .react-select__menu-list {
    @apply py-1;
    max-height: 240px;
    overflow-y: auto;

    /* Custom scrollbar */
    &::-webkit-scrollbar {
      width: 6px;
    }

    &::-webkit-scrollbar-track {
      @apply bg-muted/20;
    }

    &::-webkit-scrollbar-thumb {
      @apply bg-muted-foreground/30 rounded-full;
    }

    &::-webkit-scrollbar-thumb:hover {
      @apply bg-muted-foreground/50;
    }
  }

  /* Options */
  .react-select__option {
    @apply px-3 py-2 cursor-pointer transition-colors duration-150;
    @apply hover:bg-accent hover:text-accent-foreground;
    color: hsl(var(--foreground));

    &.react-select__option--is-selected {
      @apply bg-primary text-primary-foreground;
    }

    &.react-select__option--is-focused {
      @apply bg-accent text-accent-foreground;
    }

    &.react-select__option--is-disabled {
      @apply text-muted-foreground cursor-not-allowed opacity-50;
    }
  }

  /* Grouped options */
  .react-select__group {
    @apply text-sm;
  }

  .react-select__group-heading {
    @apply px-3 py-2 text-muted-foreground bg-muted/50;
    @apply uppercase tracking-wide text-xs font-semibold;
    margin: 0;
    border-bottom: 1px solid hsl(var(--border));
  }

  /* Creatable option */
  .react-select__option--is-creatable {
    @apply border-l-4 border-primary bg-primary/5;

    &:hover {
      @apply bg-primary/10;
    }
  }

  /* Loading state */
  .react-select__loading-indicator {
    @apply text-primary;
  }

  /* Error state */
  .react-select-container.error .react-select__control {
    @apply border-destructive;

    &.react-select__control--is-focused {
      @apply ring-destructive/20;
    }
  }

  /* Clear indicator */
  .react-select__clear-indicator {
    @apply text-muted-foreground;

    &:hover {
      @apply text-destructive;
    }
  }

  /* Dropdown indicator */
  .react-select__dropdown-indicator {
    @apply text-muted-foreground transition-colors;

    &:hover {
      @apply text-foreground;
    }
  }

  /* Multi-select values */
  .react-select__multi-value {
    @apply bg-muted border border-input rounded-md text-sm;
    margin: 2px;
  }

  .react-select__multi-value__label {
    @apply px-2 py-1;
  }

  .react-select__multi-value__remove {
    @apply text-muted-foreground hover:text-destructive hover:bg-destructive/10;

    &:hover {
      border-radius: 0 0.25rem 0.25rem 0;
    }
  }

  /* Keyboard navigation focus */
  .react-select__option:active {
    @apply bg-accent text-accent-foreground;
  }
}

/* Hierarchy indicators for categories */
@layer components {
  .hierarchy-indent-1 {
    @apply pl-4;
  }

  .hierarchy-indent-2 {
    @apply pl-8;
  }

  .hierarchy-indent-3 {
    @apply pl-12;
  }

  .hierarchy-indent-4 {
    @apply pl-16;
  }

  .hierarchy-line {
    position: relative;

    &::before {
      content: '';
      position: absolute;
      left: -12px;
      top: 0;
      bottom: 0;
      width: 1px;
      @apply bg-border;
    }
  }
}

/* Drag and drop visual feedback */
@layer utilities {
  .dragging {
    @apply opacity-50 cursor-grabbing scale-95;
    transition: all 0.2s ease;
  }

  .drop-target {
    @apply border-2 border-dashed border-primary bg-primary/5 scale-105;
    transition: all 0.2s ease;
  }

  .drop-target-valid {
    @apply border-green-500 bg-green-50 dark:bg-green-950/20;
  }

  .drop-target-invalid {
    @apply border-red-500 bg-red-50 dark:bg-red-950/20;
  }

  .drop-indicator {
    @apply h-1 bg-primary rounded-full opacity-0 transition-opacity duration-200;
  }

  .drop-indicator--active {
    @apply opacity-100;
  }
}

/* Loading skeletons */
@layer components {
  .skeleton-select {
    @apply bg-muted animate-pulse rounded-md;
    height: 2.5rem;
  }

  .skeleton-text {
    @apply bg-muted animate-pulse rounded;
    height: 1rem;
    margin-bottom: 0.5rem;
  }

  .skeleton-avatar {
    @apply bg-muted animate-pulse rounded-full;
    width: 2rem;
    height: 2rem;
  }
}

/* Enhanced accessibility */
@layer utilities {
  .focus-ring {
    @apply focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2;
  }

  .focus-ring-inset {
    @apply focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary;
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .react-select__control {
      @apply border-2;
    }

    .react-select__option--is-selected {
      @apply bg-foreground text-background;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .react-select__menu,
    .react-select__option,
    .react-select__control,
    .dragging,
    .drop-target {
      transition: none;
    }

    .skeleton-select,
    .skeleton-text,
    .skeleton-avatar {
      animation: none;
    }
  }
}


/* Responsive optimizations */
@layer utilities {
  @media (max-width: 640px) {
    .react-select__menu {
      max-width: calc(100vw - 2rem);
    }

    .react-select__menu-list {
      max-height: 180px;
    }

    .hierarchy-indent-1 { @apply pl-2; }
    .hierarchy-indent-2 { @apply pl-4; }
    .hierarchy-indent-3 { @apply pl-6; }
    .hierarchy-indent-4 { @apply pl-8; }
  }
}